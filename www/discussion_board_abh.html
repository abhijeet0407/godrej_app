<!doctype html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang=""> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8" lang=""> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9" lang=""> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang=""> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        
        <link rel="stylesheet" href="css/bootstrap.min.css">

        <style>
            body {
                padding-top: 50px;
                padding-bottom: 20px;
            }
			
			
			
			
			.glyphicon { margin-right:5px;}
			.section-box h2 { margin-top:0px;}
			.section-box h2 a { font-size:15px; }
			.glyphicon-heart { color:#e74c3c;}
			.glyphicon-comment { color:#27ae60;}
			.separator { padding-right:5px;padding-left:5px; }
			.section-box hr {margin-top: 0;margin-bottom: 5px;border: 0;border-top: 1px solid rgb(199, 199, 199);}
			.post_title{ font-size:20px;}
			.comment_validation{ display:none; font-size:12px; color:#f00;}
			.comment_submit_btn{ margin-top:5px;}
			.comments_list_ul{ margin-top:5px; text-align:left; padding-left:0px;}
        </style>
        
        <link rel="stylesheet" href="css/main.css">
        <link rel="stylesheet" href="css/responsive.css">
        <link rel="stylesheet" href="css/bootstrap-theme.min.css">

        <script src="js/modernizr-2.8.3-respond-1.4.2.min.js"></script>
        <script src="js/jquery-1.11.2.min.js"></script>
        <script src="js/angular/angular.min.js"></script>
        <script src="js/ionic.min.js"></script>
        <script src="js/ionic-angular.min.js"></script>
        
    </head>
    <body>
        <!--[if lt IE 8]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->
    

    <!-- Main jumbotron for a primary marketing message or call to action -->
    

    <div class="container">
      <!-- Example row of columns -->
   		<div class="row"><div class="col-sm-12 col-xs-12 col-centered login_input_wrp pull-right"><a href="add_post.html">Add post</a></div></div>
        
      <div class="row">
      	<div class="col-sm-12 col-xs-12" >
        	
            
        <div class="login_title">Discussion Board</div>
        <!--add post-->
        		<form id="sign_up">
                <div class="col-sm-12 col-xs-12 col-centered login_input_wrp">Post Image:  <a href="javascript:void(0)" onclick="getImage();">Upload a Post</a><input type="hidden" id="profile_pic" name="post_image" /></div>
                <div class="col-sm-12 col-xs-12 col-centered login_input_wrp"><progress style="display:none;" max="100" value="0" id="ft-prog" ></progress></div>
                <div class="col-sm-12 col-xs-12 col-centered login_input_wrp"><input data-msg-required="Post Title Required" required class="login_input" type="text" placeholder="Post Title*" name="post_title" /></div>
                  <div class="col-sm-12 col-xs-12 col-centered login_input_wrp"><textarea data-msg-required="Post Description Required" required class="login_input textarea_input" type="text" placeholder="Post Description*" name="post_description" ></textarea></div>
                  <div class="col-sm-12 col-xs-12 col-centered login_input_wrp"><input type="hidden" name="id" id="profile_id" /><input type="submit" value="Submit" class="signin_btn"   /></div>
                  
                </form>
                <div class="msg col-sm-12 col-xs-12">
                	  <div class="alert alert-success success" role="alert">Post added successfully.</div>
                    <div class="alert alert-warning processing" role="alert">Processing your request please wait...</div>
                    <div class="alert alert-danger failed" role="alert">Post submission failed. Please check internet connection.</div>
                </div>
        	<!--add post end-->
        
               <div class="row">
               	<div id="posts">
                  </div>
               </div> 
        </div> 
       
      
      </div>
   
    </div> <!-- /container -->      
    
    <!--comment modal--> 
    	<!-- Modal -->
<div id="myModal" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Comments</h4>
      </div>
      <div class="modal-body">
        <input type="text" class="new_comment form-control"  />
        <span class="comment_validation">Please enter comment to submit</span>
      	 <input type="button" class="btn btn-xs btn-danger comment_submit_btn" value="comment" onkeyup="keyupFunction()" /> 
         <ul class="comments_list_ul">
         Loading...
         </ul>
        
      </div>
      </div>

  </div>
</div>
    
    <!--comment modal end-->
       

        <script src="js/bootstrap.min.js"></script>
<script src="js/jquery.validate.min.js"></script>
        <script src="js/main.js"></script>
         <script type="text/javascript">
		var statusDom = document.querySelector('#status');
		 function getImage() {
            // Retrieve image file location from specified source
            navigator.camera.getPicture(uploadPhoto, function(message) {
			alert('get picture failed');
		},{
			quality: 50, 
			destinationType: navigator.camera.DestinationType.FILE_URI,
			sourceType: navigator.camera.PictureSourceType.PHOTOLIBRARY
		}
            );
 
        }
 
        function uploadPhoto(imageURI) {
            var options = new FileUploadOptions();
            options.fileKey="file";
            options.fileName=imageURI.substr(imageURI.lastIndexOf('/')+1);
            options.mimeType="image/jpeg";
 
            var params = new Object();
            params.value1 = "test";
            params.value2 = "param";
 
            options.params = params;
            options.chunkedMode = false;
 
            var ft = new FileTransfer();
            ft.upload(imageURI, "http://himanshuverma.co.in/godrej/upload.php", win, fail, options);
			document.getElementById("ft-prog").style.display="block";
			ft.onprogress = function(progressEvent) {
				
		    var perc = Math.floor(progressEvent.loaded / progressEvent.total * 100);
			document.getElementById("ft-prog").value = perc;
				//statusDom.innerHTML = perc + "% loaded...";	
			}
			
        }
 			
        function win(r) {
        /*    console.log("Code = " + r.responseCode);
            console.log("Response = " + r.response);
            console.log("Sent = " + r.bytesSent);*/
			document.getElementById("ft-prog").value =100;
			
			document.getElementById("profile_pic").value=r.response;
			//document.getElementById("profile_img").src='http://himanshuverma.co.in/godrej/uploads/'+r.response;
           // alert(r.response);
        }
 
        function fail(error) {
            alert("An error has occurred: Code = "+ error.code);
        }
		</script>
        <script type="text/javascript">
		
			$(document).ready(function(){
			$('#profile_id').val(localStorage.getItem('userid'));
			
			//alert(localStorage.getItem('userid'));
			////////////////
			
			$('.signin_btn').click(function(){
					$('.failed').hide();
					$('.processing').hide();
					$('.success').hide();
					
					 $("#sign_up").validate({
      				  submitHandler:function (form){
						  	///
									$('.signin_btn').attr('disabled','disabled');
									$('.processing').show();
										var signup_data=$('#sign_up').serialize();
										$.ajax({
									  	  crossDomain:true,	
										  type:'POST',
										  url:'http://himanshuverma.co.in/godrej/add_post.php',
										  data:signup_data,
										  success:function(data){
											  if(data=='1'){
												  $('.processing').hide();
												  
												  $('.login_input').val('');
												  $('.success').show();
												  setTimeout(function(){ window.location.href='discussion_board.html' }, 2000);	
											  }else{
												  $('.processing').hide();
												  $('.failed').show();
												  $('.signin_btn').removeAttr('disabled');
											  }
											  
											  
											  },
										  error:function(){
											$('.failed').show();
											$('.signin_btn').removeAttr('disabled');
											},
										  fail: function(){
											$('.failed').show();
											$('.signin_btn').removeAttr('disabled');
										  },
										  timeout: 40000 
									  
									  })
							
							
							
							
							////
						  
						  
						  
                     
					 	 }
                      });
					
				
					
				})
				
			
			
			///////////
				//setTimeout(function(){ window.location.href='login.html' }, 2000);	
	/*			$.getJSON( "ajax/test.json", function( data ) {
  var items = [];
  $.each( data, function( key, val ) {
    items.push( "<li id='" + key + "'>" + val + "</li>" );
  });*/
  
  
  			var posts_complete=$.getJSON('http://himanshuverma.co.in/godrej/discussion_board_json.php?userid='+localStorage.getItem('userid'), function(data){
						//	console.log(data);
						 posts=data;
					console.log(posts)
					});
  
  			posts_complete.complete(function(data) {
				//console.log(size);
				$.each(posts,function(){
					var liked='';
					if(this.liked=='yes'){
					liked='yes';	
					}
					$('#posts').append(' <div class="col-xs-12 col-sm-12">'
            +'<div class="well well-sm">'
               +'<div class="row">'
                    +'<div class="col-xs-4 col-md-4 text-center">'
                        +'<img src="http://www.himanshuverma.co.in/godrej/uploads/'+this.post_image+'" alt="bootsnipp"'
                            +'class="img-rounded img-responsive" />'
                    +'</div>'
                    +'<div class="col-xs-8 col-md-8 section-box">'
                       + '<div class="post_title">'+this.title+''
                        +'</div>'
                        +'<p class="post_description">'+this.description+'</p>'
                       + '<hr />'
                        +'<div class="row rating-desc">'
                            +'<div class="col-md-12">'
                               + '<a href="javascript:void(0)" class="like-btn" rel="'+this.postid+'" target="_blank"><span class="glyphicon glyphicon-heart like-count"></span>'+this.likes_count+'</a><span class="separator">|</span>'
                               + '<a href="javascript:void(0)" class="comment-btn" rel="'+this.postid+'"  target="_blank"><span class="glyphicon glyphicon-comment"></span><span class="comment_count">('+this.comments_count+')</span></a>'
                            +'</div>'
                       + '</div>'
                    +'</div>'
               + '</div>'
            +'</div>'
       + '</div>')
					
					})
			})
  
  
  
  		$('body').on('click','.like-btn',function(){
		$(this)	.unbind('click');
		var status='like';
		var postid=$(this)	.attr('rel');
		var userid=	localStorage.getItem('userid');
		var prev_count_no=parseInt($(this).text());
		var count_no=parseInt($(this).text());
		if($(this).hasClass('glyphicon-heart')){
		$(this).removeClass('glyphicon-heart');
		$(this).addClass('glyphicon-heart-empty');
		status='unlike';
			if(count_no>0){
				count_no=count_no-1;	
				$(this).text(count_no);
				
			}
		}else{
			$(this).removeClass('glyphicon-heart-empty');
			$(this).addClass('glyphicon-heart');
			count_no=count_no+1;	
			$(this).text(count_no);
			$(this).bind('click');
		}
		
		
		//
			
			$.ajax({
									  	  crossDomain:true,	
										  type:'POST',
										  url:'http://himanshuverma.co.in/godrej/like_process.php',
										  data:'postid='+postid+'&userid='+userid+'&status='+status,
										  success:function(data){
											  $('a.like-btn[rel="'+postid+'"]').bind('click');
											  
											  
											  },
										  error:function(){
											
											$('a.like-btn[rel="'+postid+'"]').bind('click');
											},
										  fail: function(){
											$('a.like-btn[rel="'+postid+'"]').bind('click');
											
										  },
										  timeout: 40000 
									  
									  })
			
			
			//
		
		
			
		})	
		
		
		///
		var comm='';
		$('body').on('click','.comment-btn',function(){
			$('#myModal').modal('show');
			$('a.comment-btn[rel="'+postid+'"]').unbind('click');
			var postid=$(this).attr('rel');
			$('.comment_submit_btn').attr('rel',postid);
			
									/*$.ajax({
									  	  crossDomain:true,	
										  type:'POST',
										  url:'http://himanshuverma.co.in/godrej/comment_show.php',
										  data:'postid='+postid,
										  success:function(data){
											  //$('a.comment-btn[rel="'+postid+'"]').bind('click');
											  $('.comments_list_ul').html('');
											 if(data==0) {
												  $('.comments_list_ul').html('Be the first to comment');
											 }else{
												
												
												
												 
											 }
											  },
										  error:function(){
											
											//$('a.comment-btn[rel="'+postid+'"]').bind('click');
											},
										  fail: function(){
										//	$('a.comment-btn[rel="'+postid+'"]').bind('click');
											
										  },
										  timeout: 40000 
									  
									  })*/
									  
									  
								display_comments(postid)
			
			
				
			
		})
		
		
		
		///
		
		
		
		$('body').on('click','.comment_submit_btn',function(){
			var postid=$(this).attr('rel');
			var userid=	localStorage.getItem('userid');
			if($('.new_comment').val()==''){
					$('.comment_validation').show();
			}else{
				$('.comment_validation').hide();
				
				var comment_text=encodeURIComponent($('.new_comment').val());
				
				/////////
				
				
					$.ajax({
									  	  crossDomain:true,	
										  type:'POST',
										  url:'http://himanshuverma.co.in/godrej/insert_comment.php',
										  data:'postid='+postid+'&userid='+userid+'&comment='+comment_text,
										  success:function(data){
											  $('a.comment-btn[rel="'+postid+'"]').bind('click');
											  $('.new_comment').val('');
											  display_comments(postid);
											  
											  },
										  error:function(){
											
											$('a.comment-btn[rel="'+postid+'"]').bind('click');
											},
										  fail: function(){
											$('a.comment-btn[rel="'+postid+'"]').bind('click');
											
										  },
										  timeout: 40000 
									  
									  })
				
				
				
				///////
				
				
			}
			
		})
		
		function keyupFunction(){
			if($('.new_comment').val()==''){
					$('.comment_validation').show();
			}else{
				$('.comment_validation').hide();
			}
			
		}
		
		
		
		
		function display_comments(postid){
			
			$('.comments_list_ul').height($(window).height()-150);
			$('.comments_list_ul').css('overflow-y','auto');
				  var comments_complete=$.getJSON('http://himanshuverma.co.in/godrej/comment_show.php?postid='+postid, function(data){
						//	console.log(data);
						 comm=data;
					//console.log(posts)
					});
  
  			comments_complete.complete(function(data) {
				//console.log(size);
				
				 $('.comments_list_ul').html('');
											 if(comm==0) {
												  $('.comments_list_ul').html('Be the first to comment');
											 }else{
				
				 $('.comments_list_ul').html('');
				$.each(comm,function(){
					$('.comments_list_ul').append('<li><div class="emp_name">'+this.emp_name+'</div><div class="emp_comment">'+this.comment+'</div></li>')
					
					})
					
					
											 }//if comment not zero
					
					
			})
			
			
			
		}
		
  
  
			})
		 </script>

        <!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
        
    </body>
</html>
